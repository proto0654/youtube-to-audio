# YouTube to Audio Telegram Bot

Телеграм-бот для скачивания аудио из YouTube видео, созданный с использованием aiogram 3, yt-dlp и ffmpeg.

## Возможности

- Скачивание аудио из YouTube по ссылке
- Конвертация в MP3 формат с автоматическим добавлением метаданных
- Извлечение и использование информации о треке (исполнитель, название, обложка)
- Поиск музыки в YouTube Music с пагинацией
- Фильтрация результатов (исключение треков длиннее 15 минут)
- Оптимизированная загрузка для быстрой работы

## Требования

- Python 3.10+
- aiogram 3.1.1+
- yt-dlp
- imageio-ffmpeg
- ytmusicapi
- python-dotenv

## Установка

1. Клонировать репозиторий:
```
git clone https://github.com/username/youtube-to-audio.git
cd youtube-to-audio
```

2. Создать виртуальное окружение и установить зависимости:
```
python -m venv venv
venv\Scripts\activate  # для Windows
pip install -r requirements.txt
```

3. Создать файл `.env` в корне проекта и добавить токен бота:
```
BOT_TOKEN=your_bot_token_here
```

## Запуск

```
python main.py
```

## Структура проекта

```
youtube-to-audio/
│
├── main.py              # Точка входа в приложение
├── config.py            # Конфигурация и загрузка переменных окружения
├── requirements.txt     # Зависимости проекта
├── .env                 # Файл с переменными окружения (не включен в репозиторий)
│
├── handlers/            # Обработчики команд и сообщений
│   ├── __init__.py
│   ├── start.py         # Обработка команды /start
│   ├── callbacks.py     # Обработчики inline-колбэков
│   ├── search.py        # Обработка поисковых запросов и пагинации
│   └── link_handler.py  # Обработка ссылок на YouTube
│
├── keyboards/           # Клавиатуры
│   ├── __init__.py
│   └── inline.py        # Inline-клавиатуры
│
└── services/            # Сервисы для работы с API
    ├── __init__.py
    └── youtube.py       # Логика поиска и скачивания аудио с YouTube
```

## Оптимизации

В последнем обновлении были внесены следующие оптимизации:

1. **Ускорение загрузки аудио**:
   - Устранение двойных загрузок
   - Прямая загрузка с оптимальными параметрами
   - Параллельное скачивание фрагментов
   - Минимизация предварительной обработки

2. **Оптимизация поиска**:
   - Сокращение количества API-запросов
   - Фильтрация длинных треков (более 15 минут)
   - Комбинирование результатов из разных источников
   - Настройка таймаутов и повторных попыток

3. **Улучшение пользовательского опыта**:
   - Пагинация результатов поиска (10 на страницу)
   - Более информативные сообщения о прогрессе
   - Улучшенный UI с кнопками навигации
   - Отображение общего количества найденных результатов

4. **Улучшение работы с метаданными аудио**:
   - Извлечение информации о треке из YouTube
   - Интеллектуальный анализ и улучшение метаданных:
     - Автоматическое разделение строки "Исполнитель - Название трека"
     - Определение исполнителя по таким ключевым словам как "by", "feat.", "ft."
     - Очистка названия от суффиксов вроде "(Official Video)", "[HD]", "(Lyrics)"
   - Добавление метаданных в MP3-файл (исполнитель, название, альбом)
   - **Оптимизированная работа с обложками:**
     - Загрузка обложки видео с YouTube
     - Подготовка обложки только для Telegram
     - При необходимости конвертация из WebP и других форматов в JPG для Telegram
     - Автоматическое получение обложки напрямую по URL, если основной метод не сработал
     - Отправка аудио с отдельной обложкой в Telegram для оптимального отображения в чате
   - Корректное отображение метаданных и обложки в Telegram

## Лицензия

MIT 